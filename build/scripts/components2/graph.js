define(["lib/clib"],function(e){function t(e,t){console.assert(e&&t),this.canvasWidth=e,this.canvasHeight=t,this.plotWidth=this.canvasWidth-30,this.plotHeight=this.canvasHeight-20,this.xStart=this.canvasWidth-this.plotWidth,this.yStart=this.canvasHeight-this.plotHeight,this.XAxisPlotMinValue=1e4,this.YAxisSizeMultiplier=2,this.YAxisInitialPlotValue="cero"}return t.prototype.resize=function(e){this.canvasWidth=e,this.plotWidth=this.canvasWidth-20,this.xStart=this.canvasWidth-this.plotWidth},t.prototype.setData=function(e,t,n){this.ctx=e,this.canvas=t,this.engine=n,this.gameState=n.gameState,this.userState=n.userState,this.cashingOut=n.cashingOut,this.lag=n.lag,this.startTime=n.startTime,this.gameState=="IN_PROGRESS"?(this.lastBalance=n.getGamePayout(),this.currentTime=n.getElapsedTime()):(this.lastBalance=0,this.currentTime=0)},t.prototype.calculatePlotValues=function(){this.YAxisPlotMinValue=this.YAxisSizeMultiplier,this.YAxisPlotValue=this.YAxisPlotMinValue,this.XAxisPlotValue=this.XAxisPlotMinValue,this.currentTime>this.XAxisPlotMinValue&&(this.XAxisPlotValue=this.currentTime),this.lastBalance>this.YAxisPlotMinValue&&(this.YAxisPlotValue=this.lastBalance),this.YAxisPlotValue-=1,this.widthIncrement=this.plotWidth/this.XAxisPlotValue,this.heightIncrement=this.plotHeight/this.YAxisPlotValue,this.currentX=this.currentTime*this.widthIncrement},t.prototype.clean=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.drawGraph=function(){this.ctx.strokeStyle="Black",this.userState==="PLAYING"?(this.ctx.lineWidth=6,this.ctx.strokeStyle="#7cba00"):this.cashingOut?(this.ctx.lineWidth=6,this.ctx.strokeStyle="Grey"):this.ctx.lineWidth=4,this.ctx.beginPath(),e.seed(1);for(var t=0,n=0;t<=this.currentTime;t+=100,n++){var r=this.engine.calcGamePayout(t)-1,i=this.plotHeight-r*this.heightIncrement,s=t*this.widthIncrement;this.ctx.lineTo(s+this.xStart,i);if(n>5e3){console.log("For 1 too long!");break}}this.ctx.stroke()},t.prototype.drawAxes=function(){function e(e){console.assert(Number.isFinite(e));var t=.4,n=.1;for(;;){if(e<t)return n;t*=5,n*=2;if(e<t)return n;t*=2,n*=5}}this.YAxisPlotMaxValue=this.YAxisPlotMinValue,this.payoutSeparation=e(this.lastBalance?this.lastBalance:1),this.ctx.lineWidth=1,this.ctx.strokeStyle="Black",this.ctx.font="10px Verdana",this.ctx.fillStyle="black";var t=this.plotHeight/this.YAxisPlotValue;for(var n=this.payoutSeparation,r=0;n<this.YAxisPlotValue;n+=this.payoutSeparation,r++){var i=this.plotHeight-n*t;this.ctx.fillText(n+1+"x",0,i),this.ctx.beginPath(),this.ctx.moveTo(this.xStart,i),this.ctx.lineTo(this.xStart+5,i),this.ctx.stroke();if(r>100){console.log("For 3 too long");break}}this.milisecondsSeparation=e(this.XAxisPlotValue),this.XAxisValuesSeparation=this.plotWidth/(this.XAxisPlotValue/this.milisecondsSeparation);for(var s=0,o=0,r=0;s<this.XAxisPlotValue;s+=this.milisecondsSeparation,o++,r++){var u=s/1e3,a=this.ctx.measureText(u).width,f=o*this.XAxisValuesSeparation+this.xStart;this.ctx.fillText(u,f-a/2,this.plotHeight+11);if(r>100){console.log("For 4 too long");break}}this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(this.xStart,0),this.ctx.lineTo(this.xStart,this.canvasHeight-this.yStart),this.ctx.lineTo(this.canvasWidth,this.canvasHeight-this.yStart),this.ctx.stroke()},t.prototype.drawGameData=function(){this.engine.gameState==="IN_PROGRESS"&&(this.userState==="PLAYING"?this.ctx.fillStyle="#7cba00":this.ctx.fillStyle="black",this.ctx.font="80px Verdana",this.ctx.fillText(parseFloat(this.lastBalance).toFixed(2)+"x",150,150)),this.engine.gameState==="ENDED"&&this.engine.lastGameCrashedAt&&(this.ctx.fillStyle="red",this.ctx.font="60px Verdana",this.ctx.fillText("Game crashed",100,100),this.ctx.fillText("@ "+e.formatSatoshis(this.engine.lastGameCrashedAt)+"x",160,180))},t});