define(["lib/react","lib/clib","lib/lodash","components/countdown","components/bet_button","components/cashout_button"],function(e,t,n,r,i,s){var o=e.DOM;return e.createClass({displayName:"Controls",propTypes:{engine:e.PropTypes.object.isRequired},getInitialState:function(){return{bet_size:"1",cash_out:"2.00"}},invalidBet:function(){var e=this;if(e.props.engine.balanceSatoshis<100)return"Not enough bits to play";var n=t.parseBet(e.state.bet_size);if(n instanceof Error)return n.message;var r=t.parseAutoCash(e.state.cash_out);return r instanceof Error?n.message:e.props.engine.balanceSatoshis<n*100?"Not enough bits":null},getStatusMessage:function(){var e=this.props.engine.currentPlay();if(this.props.engine.gameState==="STARTING")return r({engine:this.props.engine});if(this.props.engine.gameState==="IN_PROGRESS")return e&&e.bet&&!e.stopped_at?o.span(null,"Currently playing..."):e&&e.stopped_at?o.span(null,"Cashed Out @  ",o.b({className:"green"},e.stopped_at/100,"x")," / Won: ",o.b({className:"green"},t.formatSatoshis(e.bet*e.stopped_at/100))," ",t.grammarBits(e.bet*e.stopped_at/100)):o.span(null,"Game in progress..");if(this.props.engine.gameState==="ENDED"){if(e&&e.stopped_at){var n;return e.bonus&&(n=o.span(null," (+",t.formatSatoshis(e.bonus)," ",t.grammarBits(e.bonus)," bonus)")),o.span(null,"Cashed Out @ ",o.b({className:"green"},e.stopped_at/100,"x")," / Won: ",o.b({className:"green"},t.formatSatoshis(e.bet*e.stopped_at/100))," ",t.grammarBits(e.bet*e.stopped_at/1e3),n)}if(e){var n;return e.bonus&&(n=o.span(null," (+ ",t.formatSatoshis(e.bonus)," ",t.grammarBits(e.bonus)," bonus)")),o.span(null,"Game crashed @ ",o.b({className:"red"},this.props.engine.tableHistory[0].game_crash/100,"x")," / You lost ",o.b({className:"red"},e.bet/100)," ",t.grammarBits(e.bet),n)}return o.span(null,"Game crashed @ ",o.b({className:"red"},this.props.engine.tableHistory[0].game_crash/100,"x"))}},copyHash:function(){prompt("Game "+this.props.engine.gameId+" hash:",this.props.engine.hash)},getControlInputs:function(){var e=this,t=o.div(null,o.span({className:"bet-span strong"},"Bet"),o.input({type:"text",name:"bet-size",value:e.state.bet_size,onChange:function(t){e.setState({bet_size:t.target.value})}}),o.span({className:"sticky"},"Bits")),n=o.div(null,o.div({className:"auto-cash-out-span"},"Auto Cash Out @ "),o.input({min:1.1,value:e.state.cash_out,type:"number",name:"cash_out",onChange:function(t){e.setState({cash_out:t.target.value})}}),o.span({className:"sticky"},"x"));return o.div({className:"inputs-cont grid grid-pad"},o.div({className:"col-1-1"},t),o.div({className:"col-1-1"},n))},placeBet:function(){var e=parseInt(this.state.bet_size.replace(/k/g,"000"))*100;console.assert(n.isFinite(e));var t=parseFloat(this.state.cash_out);console.assert(n.isFinite(t)),t=Math.round(t*100),console.assert(n.isFinite(t)),this.props.engine.bet(e,t,function(e){e&&console.error("Got betting error: ",e)})},render:function(){var e=this,t=this.props.engine.currentPlay();if(!this.props.engine.username)return o.div({className:"login-container grid grid-pad"},o.div({className:"controls"},o.div({className:"login"},o.a({className:"big-button unselect",href:"/login"},"Login to play"),o.a({href:"/register",className:"register"},"or register "))));var n;this.props.engine.isBetting()?n=!1:this.props.engine.gameState==="IN_PROGRESS"&&t&&t.bet&&!t.stopped_at?n=!1:n=!0;var r=n||this.props.engine.isBetting(),u;r?u=i({engine:this.props.engine,invalidBet:this.invalidBet,placeBet:this.placeBet}):u=s({engine:this.props.engine,invalidBet:this.invalidBet});var a,f,l;return n?(a="col-1-2 mobile-col-1-1",l=o.div({className:"col-1-2 mobile-col-1-1"},this.getControlInputs())):(a="col-1-1 mobile-col-1-1",l=null),f=o.div({className:a},u),o.div(null,o.div({className:"controls-container"},o.h5({className:"information"},this.getStatusMessage()),o.div({className:"controls-grid grid grid-pad"},l,f)),o.div({className:"hash-cont"},o.span({className:"hash-text"},"Hash"),o.input({className:"hash-input",type:"text",value:this.props.engine.hash,readOnly:!0}),o.div({className:"hash-copy-cont",onClick:e.copyHash},o.span({className:"hash-copy"},o.i({className:"fa fa-clipboard"})))))}})});