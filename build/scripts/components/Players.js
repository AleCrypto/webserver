define(["lib/react","lib/clib","lib/lodash","stores/EngineVirtualStore"],function(e,t,n,r){function o(e,t){return(t-100)*e/100}function u(){return{engine:r.getState()}}var i=e.DOM,s=e.addons.classSet;return e.createClass({displayName:"usersPlaying",getInitialState:function(){return u()},componentDidMount:function(){r.addChangeListener(this._onChange)},componentWillUnmount:function(){r.removeChangeListener(this._onChange)},_onChange:function(){this.isMounted()&&this.setState(u())},render:function(){var e=this,r=[],u=[],a,f,l,c,h;e.state.engine.gameState==="STARTING"?u=e.state.engine.joined.map(function(t){var n;return t===e.state.engine.username&&(n=e.state.engine.nextBetAmount),{username:t,info:{bet:n}}}):(n.forEach(e.state.engine.playerInfo,function(e,t){e.stopped_at?r.push({username:t,info:e}):u.push({username:t,info:e})}),r.sort(function(e,t){var n=t.info.stopped_at-e.info.stopped_at;return n!==0?n:e.username<t.username?1:-1}),u.sort(function(e,t){var n=t.info.bet-e.info.bet;return n!==0?n:e.username<t.username?1:-1}));if(e.state.engine.gameState==="IN_PROGRESS"||e.state.engine.gameState==="STARTING"){var p,d;f=[];for(p=0,d=u.length;p<d;p++){var v=s({"user-playing":!0,me:e.state.engine.username===u[p].username});f.push(i.tr({className:v,key:"user"+p},i.td(null,i.a({href:"/user/"+u[p].username,target:"_blank"},u[p].username)),i.td(null,"-"),i.td(null,u[p].info.bet?t.formatSatoshis(u[p].info.bet,0):"?"),i.td(null,"-"),i.td(null,"-")))}a=[];for(p=0,d=r.length;p<d;p++){var m=r[p],g=m.info.bet,y=o(g,m.info.stopped_at),v=s({"user-cashed":!0,me:e.state.engine.username===m.username});a.push(i.tr({className:v,key:"user"+p},i.td(null,i.a({href:"/user/"+m.username,target:"_blank"},m.username)),i.td(null,m.info.stopped_at/100+"x"),i.td(null,t.formatSatoshis(g,0)),i.td(null,"-"),i.td(null,t.formatSatoshis(y))))}l=i.tbody({className:""},f,a),c="users-playing-container",h="users-playing"}else e.state.engine.gameState==="ENDED"&&(f=u.map(function(n,r){var o=n.info.bet,u=n.info.bonus,a=-o;u?(a=t.formatSatoshis(a+u),u=t.formatDecimals(u*100/o,2)+"%"):(a=t.formatSatoshis(a),u="0%");var f=s({"user-lost":!0,me:e.state.engine.username===n.username});return i.tr({className:f,key:"user"+r},i.td(null,i.a({href:"/user/"+n.username,target:"_blank"},n.username)),i.td(null,"-"),i.td(null,t.formatSatoshis(n.info.bet,0)),i.td(null,u),i.td(null,a))}),a=r.map(function(n,r){var o=n.info.bet,u=n.info.bonus,a=n.info.stopped_at,f=o*(a-100)/100;u?(f=t.formatSatoshis(f+u),u=t.formatDecimals(u*100/o,2)+"%"):(f=t.formatSatoshis(f),u="0%");var l=s({"user-won":!0,me:e.state.engine.username===n.username});return i.tr({className:l,key:"user"+r},i.td(null,i.a({href:"/user/"+n.username,target:"_blank"},n.username)),i.td(null,a/100,"x"),i.td(null,t.formatSatoshis(o,0)),i.td(null,u),i.td(null,f))}),l=i.tbody({className:""},f,a),c="users-cashed-container",h="users-summary");return i.div({className:c},i.table({className:h},i.thead(null,i.tr(null,i.th(null,"User"),i.th(null,"@"),i.th(null,"Bet"),i.th(null,"Bonus"),i.th(null,"Profit"))),l))}})});