define(["lib/react","lib/clib","lib/lodash"],function(e,t,n){function i(e,t){return(t-100)*e/100}var r=e.DOM;return e.createClass({displayName:"usersPlaying",propTypes:{engine:e.PropTypes.object.isRequired},render:function(){var e=this,s=[],o=[],u,a,f,l,c;e.props.engine.gameState==="STARTING"?o=e.props.engine.joined.map(function(t){var n;return t===e.props.engine.username&&(n=e.props.engine.nextBetAmount),{username:t,info:{bet:n}}}):(n.forEach(e.props.engine.playerInfo,function(e,t){e.stopped_at?s.push({username:t,info:e}):o.push({username:t,info:e})}),s.sort(function(e,t){var n=t.info.stopped_at-e.info.stopped_at;return n!==0?n:e.username<t.username?1:-1}),o.sort(function(e,t){var n=t.info.bet-e.info.bet;return n!==0?n:e.username<t.username?1:-1}));if(e.props.engine.gameState==="IN_PROGRESS"||e.props.engine.gameState==="STARTING"){a=[];for(var h=0,p=o.length;h<p;h++)a.push(r.tr({className:"user-playing",key:"user"+h},r.td(null,r.a({href:"/user/"+o[h].username,target:"_blank"},o[h].username)),r.td(null,"-"),r.td(null,o[h].info.bet?t.formatSatoshis(o[h].info.bet,0):"?"),r.td(null,"-"),r.td(null,"-")));u=[];for(var h=0,p=s.length;h<p;h++){var d=s[h],v=d.info.bet,m=i(v,d.info.stopped_at);u.push(r.tr({className:"user-cashed",key:"user"+h},r.td(null,r.a({href:"/user/"+d.username,target:"_blank"},d.username)),r.td(null,d.info.stopped_at/100+"x"),r.td(null,t.formatSatoshis(v,0)),r.td(null,"-"),r.td(null,t.formatSatoshis(m))))}f=r.tbody({className:""},a,u),l="users-playing-container",c="users-playing"}else e.props.engine.gameState==="ENDED"&&(a=o.map(function(e,n){var i=e.info.bet,s=e.info.bonus,o=-i;return s?(o=t.formatSatoshis(o+s),s=t.formatDecimals(s*100/i,2)+"%"):(o=t.formatSatoshis(o),s="0%"),r.tr({className:"user-lost",key:"user"+n},r.td(null,r.a({href:"/user/"+e.username,target:"_blank"},e.username)),r.td(null,"-"),r.td(null,t.formatSatoshis(e.info.bet,0)),r.td(null,s),r.td(null,o))}),u=s.map(function(e,n){var i=e.info.bet,s=e.info.bonus,o=e.info.stopped_at,u=i*(o-100)/100;return s?(u=t.formatSatoshis(u+s),s=t.formatDecimals(s*100/i,2)+"%"):(u=t.formatSatoshis(u),s="0%"),r.tr({className:"user-won",key:"user"+n},r.td(null,r.a({href:"/user/"+e.username,target:"_blank"},e.username)),r.td(null,o/100,"x"),r.td(null,t.formatSatoshis(i,0)),r.td(null,s),r.td(null,u))}),f=r.tbody({className:""},a,u),l="users-cashed-container",c="users-summary");return r.div({className:l},r.table({className:c},r.thead(null,r.tr(null,r.th(null,"User"),r.th(null,"@"),r.th(null,"Bet"),r.th(null,"Bonus"),r.th(null,"Profit"))),f))}})});