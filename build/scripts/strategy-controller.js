define(["strategies/strategies","engine-controller","lib/events","lib/lodash"],function(e,t,n,r){var i=function(t){r.extend(this,n),this.engine=t,this.engineController=null,this.strategy=e.autoBet,this.active=!1,this.selectedStrategy="autoBet",this.widgetStates={};for(var i in e)e[i].isWidget&&(this.widgetStates[i]=e[i].initialState)};return i.prototype.runStrategy=function(){console.assert(!this.engineController);var e;this.strategy.isWidget?e=this.strategy.logic(this.widgetStates[this.selectedStrategy]):e=new Function("engine",this.strategy),this.engineController=new t(this.engine,e,this.stopScript.bind(this)),this.active=!0,this.trigger("change"),this.trigger("widget_change")},i.prototype.stopScript=function(){this.engineController.stop(),this.engineController=null,this.active=!1,this.trigger("change"),this.trigger("widget_change")},i.prototype.updateScript=function(e){console.assert(!this.strategy.isWidget),this.strategy=e,this.trigger("change")},i.prototype.selectStrategy=function(t){console.assert(e.hasOwnProperty(t)),this.selectedStrategy=t,this.strategy=e[t],this.trigger("change")},i.prototype.getState=function(){return{active:this.active,strategy:this.strategy,selectedStrategy:this.selectedStrategy}},i.prototype.dataInvalid=function(){return(this.strategy.isWidget?this.widgetStates[this.selectedStrategy].invalidData:!1)||!this.engine.username},i.prototype.setWidgetState=function(e,t){console.assert(this.strategy.isWidget),this.widgetStates[this.selectedStrategy][e]=t,this.validateInput(),this.trigger("widget_change"),this.trigger("change")},i.prototype.getWidgetState=function(){return console.assert(this.strategy.isWidget),this.widgetStates[this.selectedStrategy]},i.prototype.getEditorState=function(){return this.active},i.prototype.validateInput=function(){this.strategy.isWidget?this.widgetStates[this.selectedStrategy].invalidData=this.strategy.validate(this.widgetStates[this.selectedStrategy]):this.widgetStates[this.selectedStrategy].invalidData=!1},i});